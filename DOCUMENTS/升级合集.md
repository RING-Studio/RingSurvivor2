# 升级合集

## 通用升级

声明：射速、装填、冷却
    - 是运作方式相同的三个属性，本质都是每隔一定时间触发
    - 作用于不同的武器/配件
        - 例如机炮使用的是射速属性，地雷使用的是装填属性，维护工具箱使用的是冷却属性

### 通用升级列表

| 品质 | 名称 | ID | 效果 | 最大等級（MaxLevel） | 类型 |
| --- | --- | --- | --- | --- | --- |
| 白 | 暴击强化 | `crit_rate` | 暴击率 +2lv% | -1 | 强化 |
| 白 | 暴伤强化 | `crit_damage` | 暴击伤害 +10lv% | -1 | 强化 |
| 白 | 伤害强化 | `damage_bonus` | 伤害 +5lv% | -1 | 强化 |
| 白 | 耐久强化 | `health` | 耐久上限 +5lv | -1 | 强化 |
| 蓝 | 地雷 | `mine` | 每{装填}秒放置一个地雷，接触敌人后对{爆炸范围}范围内敌人造成{基础伤害=5lv}点伤害。部署上限：10+5lv | 4 | 配件 |
| 白 | 地雷·范围 | `mine_range` | 地雷爆炸范围+1.5lv米 | 5 | 强化（专属） |
| 白 | 地雷·冷却 | `mine_cooldown` | 地雷装填-15lv% | 5 | 强化（专属） |
| 紫 | 地雷·AT | `mine_anti_tank` | 地雷装填+5秒，地雷基础伤害+200lv%。地雷仅能由精英或BOSS触发 | 5 | 强化（专属） |
| 红 | 冷却装置 | `cooling_device` | 冷却 -10lv% | 3 | 配件 |

### 通用·生命回复与生存

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 白 | 散热器 | `heat_sink` | 耐久上限 -5lv。耐久上限越低，冷却越快（冷却 -{初始耐久上限-耐久上限}*0.1lv% | 5 | 强化 |
| 白 | 维护工具箱 | `repair_kit` | 每{冷却}秒回复 1 点耐久。冷却：15/12/10/9/8/7/6/5/4 | 9 | 强化 |
| 白 | 车载空调 | `cabin_ac` | 回复耐久时，-5lv%冷却，持续3秒。不可叠加。 | 5 | 强化 |

### 通用·移速与机动

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 蓝 | 克里斯蒂悬挂 | `christie_suspension` | 移速 +10lv% | 5 | 强化 |
| 紫 | 燃气轮机 | `gas_turbine` | 移速 +15lv% | 3 | 强化 |
| 紫 | 液气悬挂 | `hydro_pneumatic` | 受到的移速惩罚减半 | 1 | 强化 |

### 通用·伤害与暴击变体

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 蓝 | 先进热成像仪 | `thermal_imager` | 暴击率 +5% | 1 | 强化 |
| 白 | 激光测距仪 | `laser_rangefinder` | 暴击率 +4% | 1 | 强化 |
| 紫 | 半穿甲弹 | `sap_round` | 对无护甲/轻甲敌人伤害 +10lv%，暴击伤害 +30lv% | 5 | 强化 |
| 蓝 | 额外弹药架 | `extra_ammo_rack` | 耐久上限 -5lv，移速 -10%，装填 +10lv%，射速 +10lv% | 5 | 强化 |

### 通用·防御与减伤

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 蓝 | 车身附加装甲 | `addon_armor` | 耐久 +4lv，被击穿时受到的伤害减免 5lv% | 5 | 强化 |
| 蓝 | 泄压阀 | `relief_valve` | 被击穿时受到的伤害减免 10lv% | 6 | 强化 |

### 通用·撞击与碰撞（可选实现）

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 白 | 破障设备 | `breach_equip` | 撞击对命中的敌人造成 当前移速×耐久×0.5lv 点伤害 | 4 | 配件 |

### 配件（扩展）

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 蓝 | 烟雾弹 | `smoke_grenade` | 原地释放烟雾，1米范围内敌人移速 -20lv%，持续3秒。装填：10秒 | 5 | 配件 |
| 紫 | 无线电通讯 | `radio_support` | 呼叫炮击锁定随机区域，10秒后在该区域造成不分敌我的范围伤害。基础伤害：50+20lv。范围：20米。冷却：60-5lv秒 | 3 | 配件 |
| 红 | 激光压制 | `laser_suppress` | 开启后5秒内，对5米范围内正在瞄准玩家的最近的远程敌人发射激光，每秒造成5次伤害。基础伤害：4+2lv。冷却：30秒。 | 3 | 配件 |
| 蓝 | 纤维内衬 | `spall_liner` | 被动：抵御一次致命击穿伤害，触发后失效 | 1 | 配件 |
| 紫 | 爆炸反应装甲 | `era_block` | 被动：抵御一次任意致命伤害，触发后失效。可与纤维内衬共存，优先于内衬触发 | 1 | 配件 |
| 紫 | 外挂导弹 | `external_missile` | 对10米内最近敌人发射1枚导弹。基础伤害：20+10lv。爆炸范围：3米 | 3 | 配件 |
| 红 | 红外对抗 | `ir_counter` | 5米范围内正在瞄准玩家的最近的远程敌人穿甲率固定为0% | 1 | 配件 |

### 配件专属强化（扩展）示例

以下为部分新配件的专属强化示例，与地雷·范围/冷却/AT 同逻辑：拥有对应配件后，其专属强化才加入局内升级池。

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 白 | 烟雾弹·范围 | `smoke_range` | 烟雾弹影响范围 +2lv 米 | 5 | 强化（专属） |
| 白 | 烟雾弹·持续 | `smoke_duration` | 烟雾弹持续时间 +1lv 秒 | 5 | 强化（专属） |
| 白 | 无线电·半径 | `radio_radius` | 炮击影响半径 +1lv 米 | 5 | 强化（专属） |
| 蓝 | 外挂导弹·伤害 | `missile_damage` | 外挂导弹基础伤害 +25lv% | 5 | 强化（专属） |


### 系统说明
- **耐久**：即health，影响玩家的最大生命值
- **全局暴击率**：影响所有武器和配件的暴击率
- **伤害加成**：作用在计算护甲之前，在 `_compute_bullet_damage()` 中先乘以伤害加成
- **伤害强化影响范围**：伤害强化（`damage_bonus`）影响所有武器和配件的伤害，未经特殊说明的伤害加成类强化默认影响所有伤害来源
- **伤害类型**：
  - 伤害类型采用二元标签系统：伤害来源 + 是否暴击
  - **伤害来源**：`weapon`（武器）、`accessory`（配件）、`bleed`（流血）
  - **是否暴击**：布尔值，暴击时伤害数字显示为黄色，非暴击时根据伤害来源显示颜色
  - 武器伤害：白色（非暴击）或黄色（暴击）
  - 配件伤害：白色（非暴击）或黄色（暴击）
  - 流血伤害：绯红色（不暴击）

---

## 主武器强化（通用）

### 射速类强化

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 白 | 速射 | `rapid_fire` | 射速 +5lv% | -1 | 强化 |
| 蓝 | 连射 | `chain_fire` | 射速 -5lv%。主武器射击时，+3%射速，最多叠加4lv层，每1秒减少1层 | 5 | 强化 |
| 蓝 | 散弹 | `scatter_shot` | 主武器每射击10/8/7/6/5次（随等级递减），向随机方向进行1/1/2/2/3次额外射击 | 5 | 强化 |
| 紫 | 爆射 | `burst_fire` | 主武器暴击时，+4%射速，最多叠加4lv层，每1秒减少1层 | 10 | 强化 |
| 蓝 | 扫射 | `sweep_fire` | +50lv%射速。主武器射击方向变更：顺时针旋转（每帧旋转固定角度） | 2 | 强化 |
| 蓝 | 乱射 | `chaos_fire` | +100%射速。主武器射击方向变更：随机方向（每次射击完全随机） | 1 | 强化 |
| 紫 | 破竹 | `breakthrough` | 场上存在的怪物数量越少，获得越多射速加成，最多+25lv%（怪物数量N，则+25lv%/N射速） | 3 | 强化 |
| 红 | 火力压制 | `fire_suppression` | 自身配件数量越多，获得越多射速加成（配件数量N，则+5lv*N%射速） | 2 | 强化 |

### 穿透/弹道类强化

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 蓝 | 穿透 | `penetration` | 伤害 -10lv%，主武器穿透+1lv | 5 | 强化 |
| 蓝 | 风车 | `windmill` | 射速 -50%。伤害 -20/30/40%（随等级）。主武器弹道+2/3/4。主武器射击方向变更：顺时针旋转 | 3 | 强化 |
| 紫 | 弹射 | `ricochet` | 主武器子弹命中后，有(10+10lv)%概率向最近敌人弹射。弹射在穿透前判定，成功则不消耗穿透次数 | 4 | 强化 |
| 红 | 扩散 | `spread_shot` | 主武器弹道+1/2/3，每发子弹造成50%/40%/30%伤害 | 3 | 强化 |
| 红 | 分裂 | `split_shot` | 主武器暴击时，子弹分裂成2/3发（随等级），每发造成50%伤害。仅在弹射失败时触发，不消耗穿透次数。分裂子弹无法再分裂 | 2 | 强化 |

### 穿透/穿甲扩展

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 蓝 | 长倍径炮管 | `long_barrel` | 主武器穿透 +1lv，伤害 -5lv%，射速 +10lv% | 5 | 强化 |
| 紫 | 串联破甲 | `tandem_heat` | 主武器穿透 +1lv，对护甲目标的穿甲伤害倍率 +20lv% | 5 | 强化 |

### 暴击类强化

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 紫 | 屏息 | `breath_hold` | 主武器未进行射击时，以+10lv%/秒的速率给予暴击伤害加成。主武器射击后清空所有加成 | 10 | 强化 |
| 紫 | 专注 | `focus` | 主武器连续命中同一敌人时，每发+1lv%暴击率，最多叠加5层。未命中该敌人时重新计算 | 5 | 强化 |
| 紫 | 收割 | `harvest` | 暴击击杀敌人时，恢复1lv点耐久 | 5 | 强化 |
| 红 | 致命一击 | `lethal_strike` | 主武器每射击9/7/5/3次，下一次射击暴击率+100%，且暴击伤害翻倍 | 4 | 强化 |
| 红 | 暴击转换 | `crit_conversion` | 暴击时，暴击率加成会作用于暴击伤害加成 | 1 | 强化 |

### 流血与持续伤害

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 白 | 锐化 | `sharpened` | 暴击时附加的流血层数 +1lv | 3 | 强化 |
| 蓝 | 放血 | `bloodletting` | 每层流血每米造成的伤害 +0.2lv（在基础 1 点上叠加） | 5 | 强化 |
| 紫 | 撕裂 | `laceration` | 流血层数上限 +2lv，暴击时若目标已有流血则额外 +1 层 | 5 | 强化 |

### 弹道与弹速（可选实现）

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 白 | 高装药 | `hot_load` | 主武器弹速 +10lv% | 5 | 强化 |
| 蓝 | 稳定翼 | `fin_stabilized` | 主武器弹道扩散角 -20lv%（最小为 0） | 5 | 强化 |

---

## 机炮专属强化

| 品质 | 名称 | ID | 效果 | 最大等級 | 类型 |
| --- | --- | --- | --- | --- | --- |
| 蓝 | 机炮·过载 | `mg_overload` | 射速 +50%，主武器射击时，-5/4/3%射速（随等级），最多叠加12/15/20层，每1秒减少1/2/3层 | 3 | 强化（专属） |
| 紫 | 机炮·重弹 | `mg_heavy_round` | 射速 -10lv%，主武器基础伤害+1lv | 5 | 强化（专属） |
| 红 | 机炮·高爆弹 | `mg_he_round` | 主武器基础伤害+3，穿透固定为1 | 1 | 强化（专属） |
| 紫 | 机炮·编程弹 | `mg_programmed` | 对无护甲/轻甲伤害 +20lv%，射速 +10lv%。仅机炮 | 5 | 强化（专属） |

---

## 机炮基础数据

### 基础属性

- **基础伤害**：4
- **初始弹道数**：1（每次射击发出 `spread_count` 发）
- **射速（基础）**：300 发/分钟
- **弹速**：900
- **穿透次数**：0
- **弹道扩散**：每枚子弹约 ±3° 角度
- **溅射**：0（默认不产生额外连锁伤害）
- **流血层数**：0（暴击后附加的流血层）
- **每层流血伤害**：1 （每移动 1 米造成 1 点伤害并减少一层）

---

## 系统说明与实现要点

### 1. 伤害加成计算位置
- **伤害+5%类词条**：作用在计算护甲之前
- 在 `_compute_bullet_damage()` 中先乘以伤害加成，然后再进行护甲计算

### 2. 射击方向变更机制
- **扫射/风车（顺时针旋转）**：每帧旋转固定角度（在 `_process()` 中持续旋转）
- **乱射（随机方向）**：每次射击时完全随机方向（在 `on_timer_timeout()` 中生成）
- **不兼容规则**：选择其中一个后，从强化池删除其他拥有不同方向变更的强化/配件
  - 例如：选择扫射（顺时针）后，乱射（随机）被删除，但风车（也是顺时针）保留

### 3. 屏息机制
- **计时方式**：维护一个计时器，从上次射击开始计时
- **加成计算**：加成 = 未射击时间（秒）× 10lv% / 秒
  - 例如：0.5秒未射击 = 5lv%加成，1秒 = 10lv%，2秒 = 20lv%
- **重置**：每次射击时重置计时器为0，清空所有加成

### 4. 弹射机制
- **判定时机**：在穿透判定前进行
- **判定条件**：若附近没有敌人（攻击范围内没有敌人，子弹攻击范围半径继承自发射者），则直接判定不弹射
- **成功效果**：若判定成功，进行弹射且不消耗穿透次数

### 5. 分裂机制
- **触发时机**：在弹射判定失败后立刻触发（若无弹射强化，则命中后立刻触发）
- **不消耗穿透**：分裂不消耗穿透次数
- **复制方式**：分裂的子弹复制自原子弹（复制当前状态，特别是 `_hit_hurtboxes` 数组，避免立即命中同一目标）
- **伤害修改**：分裂的子弹伤害按照强化描述修改（50%伤害）
- **分裂标签**：分裂的子弹拥有分裂标签，无法再触发分裂

### 6. 属性系统变更
- **不再区分**：大部分全局属性和主武器属性（例如射速、暴击率等）
- **仍有区别**：
  - 主武器基础伤害 vs 配件基础伤害
  - 主武器穿透 vs 配件穿透
- **未来扩展**：以后有的配件可能不会吃到满射速加成

### 7. 专属强化
- **前缀标识**：类似"机炮·"、"地雷·"前缀的强化为专属强化
- **出现条件**：只有在玩家拥有相应的主武器、配件时才会在强化池中出现
- **动态加入池子**：当玩家选择地雷配件后，地雷专属强化（`mine_range`、`mine_cooldown`、`mine_anti_tank`）会被动态加入升级池；当玩家装备机炮后，机炮专属强化（`mg_overload`、`mg_heavy_round`、`mg_he_round`）会被动态加入升级池

### 8. 敌人数量获取
- 使用 `get_tree().get_nodes_in_group("enemy")` 获取场上所有敌人
- 参考 `machine_gun_ability_controller.gd` 中的实现

### 9. 配件数量获取
- 通过 `GameManager.get_vehicle_config()` 获取车辆配置
- 通过 `vehicle_config.get("配件")` 获取配件数组
- 配件数量 = 配件数组的长度

### 10. 流血处理
- 暴击后会在目标身上添加 `BleedEffect` 节点
- 每移动 1 米造成 `bleed_damage_per_layer` 点伤害，并减少一层
- 层数为 `bleed_layers`

### 11. 配件系统
- **配件类型**：配件分为两类
  - **强化型配件**：如"配件冷却"，效果类似强化，无独立实体
  - **副武器型配件**：如"地雷"，有独立实体和行为，类似副武器
- **配件获得**：局内升级时选择配件，若未拥有则获得（等级1），若已拥有则升级（等级+1）
- **配件伤害**：默认走护甲计算，伤害类型为 `"accessory"`，暴击相关与主武器类似（全局暴击率、暴击伤害等）
- **配件专属强化**：只有拥有对应配件时，其专属强化才会出现在升级池中

### 12. 地雷配件机制
- **基础属性**：
  - 基础冷却时间：待配置（建议初始值）
  - 基础爆炸范围：待配置（建议初始值）
  - 基础伤害：5×等级
  - 部署上限：10+5×等级
- **部署机制**：
  - 每{冷却时间}秒自动在玩家位置放置一个地雷
  - 地雷为 `Area2D` 节点，敌人进入范围时触发爆炸
  - 到达部署上限时，自动触发最早部署的地雷爆炸，然后放置新地雷
- **专属强化效果**：
  - `mine_range`：爆炸范围 +5×等级 米
  - `mine_cooldown`：冷却时间 -15×等级%
  - `mine_anti_armor`：冷却时间 +5秒，基础伤害 +200×等级%，仅精英/BOSS可触发
- **全局配件冷却**：`accessory_cooldown` 配件会缩短所有配件的冷却时间（-10×等级%）

### 13. 升级池动态管理
- **升级池数据库**：存储所有可用的升级条目（包括专属强化），在游戏启动时初始化，可在任何场景访问
- **局内升级池**：当前对局中实际可抽取的升级池，在进入任务时根据当前装备状态初始化
- **动态调整机制**：
  - 玩家选择配件后，将该配件的专属强化加入局内升级池
  - 玩家装备主武器后，将该主武器的专属强化加入局内升级池
  - 升级达到满级后，从局内升级池中移除
  - 互斥升级选择后，从局内升级池中移除互斥选项
- **抽取逻辑**：`pick_upgrades()` 只从局内升级池中抽取，不再进行过滤
- **支持任务前选择**：数据库初始化在autoload中，支持在任务前的武器/配件选择界面查看和选择

---

## 与数据整理的对应及实现注意

本节说明《数据整理》中旧配件/属性在本升级合集内的映射与实现要点，便于实现时对齐数值与语义。

### 属性映射（数据整理 → 当前系统）

| 数据整理字段 | 当前系统对应 | 说明 |
| --- | --- | --- |
| 生命值 / 生命回复 | 耐久 `health`、生命回复（散热器 `heat_sink`、维护工具箱 `repair_kit`） | 散热器=百分比回复，维护工具箱=固定点/秒 |
| 动力/马力 | 移速（克里斯蒂悬挂 `christie_suspension`、燃气轮机 `gas_turbine`） | 若项目尚无“移速”属性，需在玩家/载具上增加并参与移动计算 |
| 装甲厚度/击穿伤害减免 | 被击穿伤害减免（车身附加装甲 `addon_armor`、泄压阀 `relief_valve`） | 需在伤害公式中区分子弹“是否击穿”，对击穿后的伤害再乘 (1 - 减免) |
| 软攻倍率/穿甲倍率 | 伤害加成、对轻甲加成（半穿甲弹 `sap_round`）、穿甲倍率（串联破甲 `tandem_heat`） | 软攻→对无/轻甲加成；穿甲→对护甲目标的穿深或穿甲倍率，需与 FomulaManager 对接 |
| 射速/暴击率/爆伤 | 射速、暴击率、暴击伤害（与现有强化一致） | 额外弹药架、长倍径炮管、编程弹等在其上做组合或专属 |
| 地形惩罚衰减率 | 液气悬挂 `hydro_pneumatic`：减速/受控时移速惩罚减少 | 若没有地形系统，可改为“受控时间减少”或“被控时受到伤害减免”等 |

### 配件/强化对应表（数据整理 ID → 升级合集）

| 数据整理 | 升级合集中 ID / 名称 | 备注 |
| --- | --- | --- |
| 遥控武器站(0) | 已有「伤害强化」；可叠加「先进热成像仪」`thermal_imager` | 热成像对应“基础伤害+5%”的轻量版 |
| 破障设备(1) | `breach_equip` 破障设备 | 需有撞击/碰撞伤害来源与命中判定 |
| 改进自动装弹机(2) | 已有「速射」等射速强化 | — |
| 克里斯蒂悬挂(3) | `christie_suspension` 克里斯蒂悬挂 | 移速 +10lv% |
| 外挂履带板(4) | 已有「耐久强化」；可叠「车载空调」`cabin_ac` | — |
| APFSDS(5) | 穿透/穿甲向：`penetration`、`tandem_heat`、机炮·高爆弹 | — |
| 烟雾弹(6) | `smoke_grenade` 烟雾弹 | 配件、冷却、范围减速 |
| 无线电(7) | `radio_support` 无线电 | 配件、冷却、范围炮击 |
| 先进热成像仪(8) | `thermal_imager` 先进热成像仪 | 伤害 +5lv% |
| 散热器(9) | `heat_sink` 散热器 | 生命回复 5lv%/秒（按最大生命） |
| 车载空调(10) | `cabin_ac` 车载空调 | 耐久 +20lv |
| 额外弹药架(11) | `extra_ammo_rack` 额外弹药架 | 耐久 -20，伤害 +5lv%，射速 +10lv% |
| 长倍径炮管(12) | `long_barrel` 长倍径炮管 | 穿透 +1lv，伤害 -5lv%，射速 +10lv% |
| 激光测距仪(13) | `laser_rangefinder` 激光测距仪 | 暴击率 +3lv% |
| 半穿甲弹(14) | `sap_round` 半穿甲弹 | 对无/轻甲 +10lv%，暴伤 +30lv% |
| 串联破甲(15) | `tandem_heat` 串联破甲 | 穿透 +1lv，穿甲倍率 +20lv% |
| 编程弹(16) | `mg_programmed` 机炮·编程弹 | 仅机炮，软攻 +20lv%，射速 +10lv% |
| 车身附加装甲(17) | `addon_armor` 车身附加装甲 | 耐久 +50lv，击穿伤害减免 10lv% |
| 燃气轮机(18) | `gas_turbine` 燃气轮机 | 移速 +20lv% |
| 液气悬挂(19) | `hydro_pneumatic` 液气悬挂 | 减速/受控时移速惩罚 -10lv% |
| 维护工具箱(20) | `repair_kit` 维护工具箱 | 每秒回复 1lv 点耐久 |
| 激光压制(21) | `laser_suppress` 激光压制 | 配件、冷却、对瞄准玩家的远程敌人持续伤害 |
| 主动防御(22) | `active_defense` 主动防御 | 配件、次数制、拦截下一次远程弹道 |
| 纤维内衬(23) | `spall_liner` 纤维内衬 | 配件、被动、抵御一次致命穿透 |
| 爆炸反应装甲(24) | `era_block` 爆炸反应装甲 | 配件、被动、抵御一次任意致命，与内衬共存、优先触发 |
| 外挂导弹(25) | `external_missile` 外挂导弹 | 配件、冷却、对目标/最近敌人单发高伤 |
| 红外对抗(26) | `ir_counter` 红外对抗 | 配件、范围内敌人远程命中率下降或开火延迟 |
| 泄压阀(27) | `relief_valve` 泄压阀 | 被击穿伤害减免 10lv%（强化，非配件） |
| 全穿甲弹链(28) | 已有机炮·高爆弹等 | 机炮专属穿甲向已有体现 |
| 被帽风帽穿甲弹(29) | 预留榴弹专属 | 若今后有榴弹武器，可单独做「榴弹·被帽」等 |

### 实现注意

1. **移速**：克里斯蒂悬挂、燃气轮机、液气悬挂若接入，需在玩家或载具上提供“移速倍率”或“基础移速+百分比”的接口，并在移动逻辑中统一乘算。
2. **击穿与减免**：泄压阀、车身附加装甲的“被击穿伤害减免”需在护甲公式中区分“未击穿/已击穿”。仅当本次伤害视为击穿时，再应用 `(1 - 减免)`。若当前没有击穿判定，可先做“受到的所有伤害减免 x%”的简化版。
3. **对轻甲/无甲加成**：半穿甲弹、机炮·编程弹依赖敌人护甲厚度或“是否轻甲”的标记，需在 FomulaManager 或伤害链路中接入“对软目标倍率”。
4. **配件冷却与次数**：烟雾弹、无线电、激光压制、外挂导弹、红外对抗使用冷却时间；主动防御使用可恢复次数（如 3+2lv）。纤维内衬、爆炸反应装甲为一次性被动，触发后需在局内标记为已消耗。
5. **互斥与池子**：新强化与现有“扫射/乱射”等互斥逻辑无冲突；新配件的专属强化（若有）需在选定该配件后加入局内升级池，与地雷、机炮的现行规则一致。
