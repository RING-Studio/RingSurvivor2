# 注意事项

更新日期：2026-02-19

## 1. 不考虑存档兼容

只要本条注意事项存在，本项目**永远不要考虑存档兼容问题**。

- 可以随时修改任何 `ID`、字段名、数据结构
- 不需要做"旧ID→新ID"的迁移映射
- 不需要保留旧格式的兼容层
- 改了就改了，旧存档作废即可

## 2. 禁止使用 `:=` 进行类型推断

GDScript 4.5.1 的 `:=` 在右侧返回 Variant 时会导致 Parse Error。
本项目**非必要不允许使用 `:=`**，一律使用显式类型声明。

- 正确：`var dist: float = global_position.distance_to(target.global_position)`
- 错误：`var dist := global_position.distance_to(target.global_position)`
- 正确：`var label: String = "hello"`
- 错误：`var label := "hello"`
- `const` 声明可以使用 `:=`（编译期常量不受影响），但也建议显式声明类型

## 3. 禁止 preload 自身所在的 .tscn

如果一个 `.gd` 脚本是某个 `.tscn` 的根节点脚本，**禁止在该脚本中 `preload` 自身的 `.tscn`**（循环加载会导致 `Parse Error: Busy`）。

- 需要在脚本中加载自身场景时，使用 `load()` 替代 `preload()`
- 正确：`var scene: PackedScene = load("res://path/to/self.tscn")`
- 错误：`var scene: PackedScene = preload("res://path/to/self.tscn")`  ← 循环加载

## 4. 文件删除策略：假删除优先

**不要轻易删除项目中的文件**，特别是以下类型：
- 图片/音频等需要较长时间生成的资源文件
- 由外部工具生成的文件（AI 生成图标、导出资源等）
- 不确定是否仍然需要的文件

### 处理方式

| 情况 | 操作 |
|------|------|
| **确定无用/错误的文件**（空文件、临时调试输出等） | 可以直接删除 |
| **不确定是否需要的文件**（如 Godot 导入失败但外部可用的图片） | **假删除**：移动到 `.trash/` 文件夹 |
| **代码中不再引用的资源** | 先确认无其他用途，再假删除 |

### `.trash/` 文件夹规范
- 路径：项目根目录下 `.trash/`
- 已在 `.gitignore` 和 `.gdignore` 中排除（不会被 git 追踪，也不会被 Godot 导入）
- 按来源分子文件夹存放，如 `.trash/Assets_Upgrades_png/`
- 文件保留原始文件名，方便后续恢复

### 当前 `.trash/` 内容
- `.trash/Assets_Upgrades_png/`：32 个升级图标 PNG（Godot 导入报 "Not a PNG file"，但外部查看器可正常显示，可能是编码/格式兼容问题）

## 5. EnemyRank 枚举

所有敌人使用 `EnemyRank` 枚举判定等级，不使用 `is_elite`/`is_boss` 布尔值，不使用 scale 判定：

```gdscript
enum EnemyRank { NORMAL = 0, ELITE = 1, BOSS = 2 }
@export var enemy_rank: int = EnemyRank.NORMAL
```

判定代码使用 `enemy.enemy_rank >= 1` 检测精英或 Boss。

## 6. 敌人命名主题

敌人以沙漠末世为背景：
- 污染生物：甲虫、蝎子、蜱虫、蜥蜴、真菌体等
- 机械残骸：废弃军用车辆/装备

不使用弃用的 `basic_enemy` / `wizard_enemy` / `bat_enemy`（外部模板，仅作参考）。
