# Debug Console 使用指南

## 激活调试模式

在游戏运行中的**任意场景**，依次按下键盘 `D` `E` `B` `U` `G`（不区分场景和状态），即可**开启调试模式**。再次输入 `DEBUG` 可关闭。

开启后左下角会自动弹出控制台，且屏幕中央打印提示。

## 呼出/隐藏控制台

调试模式下，按 **`` ` ``**（反引号，Tab 上方的键）切换控制台显示。

控制台显示在屏幕**左下角**，包含输出区域和命令输入框。

## 输入命令

在输入框中键入命令后按 **Enter** 执行。执行后控制台自动收起。

- **Up / Down** — 浏览历史命令
- **Escape** — 不执行，直接关闭控制台

---

## 命令列表

### unlock — 解锁关卡

```
unlock level <mission_id>    # 解锁指定关卡
unlock all                   # 解锁全部关卡
```

示例：
```
unlock level recon_patrol
unlock all
```

### add — 增加资源

```
add money <数量>             # 增加金币
add <素材ID> <数量>          # 增加怪物素材
```

示例：
```
add money 500
add scarab_chitin 10
```

### get — 获取升级

```
get <upgrade_id>             # 获取 1 次该升级
get <upgrade_id> <次数>      # 获取多次（自动限制在等级上限）
```

> 仅在关卡内有效。如果存在 UpgradeManager 会走正常流程（触发信号、控制器初始化等）。

示例：
```
get machine_gun
get crit_rate 5
get howitzer 3
```

### god — 无敌模式

```
god                          # 切换无敌模式开/关
```

开启后玩家不受任何伤害。再次输入关闭。

### win / lose — 立即结算

```
win                          # 立即触发胜利结算
lose                         # 立即触发失败结算
```

> 仅在关卡内有效。`win` 会自动收集已完成的次要目标。

### xp — 增加经验

```
xp <数量>                    # 增加经验值
```

> 仅在关卡内有效（需要 ExperienceManager 节点）。

示例：
```
xp 100
```

### kill — 击杀全部敌人

```
kill                         # 击杀场上所有敌人
```

> 仅在关卡内有效。对 `enemy` 组中的所有节点造成 99999 伤害。

### money — 查看金币

```
money                        # 显示当前金币数量
```

### pollution — 污染值

```
pollution                    # 查看当前污染值
pollution <数值>             # 设置污染值
```

### time — 天数/时段

```
time                         # 查看当前天数和时段
time <天数> <时段>           # 设置天数和时段
```

示例：
```
time 3 2
```

### list — 列表查询

```
list missions                # 列出所有关卡（含解锁/通关状态）
list upgrades                # 列出当前持有的升级
list materials               # 列出素材库
```

输出中的状态标记：
- ✓ 绿色 = 已通关
- ○ 黄色 = 已解锁未通关
- ✗ 红色 = 未解锁

### npc — NPC 对话进度

```
npc                          # 查看所有 NPC 对话进度
npc <npc_id>                 # 查看指定 NPC 进度
npc <npc_id> <索引>          # 设置 NPC 对话索引
```

示例：
```
npc npc_mechanic 0           # 重置机械师对话到第一段
```

### info — 游戏状态总览

```
info                         # 显示当前游戏全局状态
```

显示内容：天数/时段、污染值/金币、当前任务、素材总量、配件解锁进度、NPC 对话记录数、关卡通关数。

### unlock_acc / ua — 解锁配件

```
unlock_acc <upgrade_id>      # 解锁指定配件
unlock_acc all               # 解锁全部配件
ua all                       # 简写
```

示例：
```
unlock_acc auto_turret
ua all
```

### save — 立即存档

```
save                         # 立即保存游戏
```

### clear — 清空输出

```
clear                        # 清空控制台输出区域
```

### help — 帮助

```
help                         # 显示所有可用命令
```

---

## 快捷键（调试模式下，控制台关闭时）

| 按键 | 功能 |
|---|---|
| `=` / 小键盘 `+` | 获取 1 点经验（关卡内） |
| `` ` `` | 打开/关闭控制台 |

---

## 注意事项

1. **调试模式附加效果**：开启调试模式后，升级刷新界面的 roll 次数显示为无限（9999）。
2. **God Mode 独立**：`god` 命令独立于调试模式存在，但只有调试模式开启时才生效。关闭调试模式会同时关闭无敌。
3. **控制台在所有场景生效**：军营、关卡、地图界面均可使用。但部分命令（`get`、`xp`、`win`、`lose`、`kill`）仅在关卡场景中有意义。
4. **升级获取的限制**：`get` 命令会检查 `max_level`，超过上限时自动停止并提示。
5. **输入阻塞**：控制台打开时，玩家移动和交互会被自动阻止。
